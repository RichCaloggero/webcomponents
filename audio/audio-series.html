<!--<link rel="import" href="../polymer/lib/elements/dom-if.html">-->
<!--<link rel="import" href="../polymer/lib/elements/dom-repeat.html">-->

<dom-module id="audio-series">
<template>
<style>
:host {
display: block;
}
</style>

<div class="audio-series">
<slot></slot>
</div>

</template>

<script>
"use strict";

class AudioSeries extends _AudioContext_ {
static get is() { return "audio-series"; }

static get properties () {
return {
label: {
type: String,
value: "series",
//observer: "labelChanged"
} // label
}; // return
} // get properties

constructor () {
super ();
this._in = audio.createGain ();
this._out = audio.createGain ();
} // constructor

connectedCallback () {
this.whenAllChildrenLoaded (this.connectAll);
} // connectedCallback

connectAll (nodes) {
if (nodes.length < 1) return;
this.debugConnection (`${this.label}: connecting all ${nodes.length} nodes`);

if (this.firstElementChild._in) {
this.debugConnection (`${this.label}: connecting  series input to ${this.firstElementChild.label} ${this.firstElementChild._in}`);
this._in.connect (this.firstElementChild._in);
} // if

for (var i=0; i<nodes.length-1; i++) {
let e1 = nodes[i], e2 = nodes[i+1];

this.debugConnection (`${this.label}: connecting ${e1.label} ${e1._out} to ${e2.label} ${e2._in}`);
e1._out.connect (e2._in);
} // for

if (this.lastElementChild._out) {
this.debugConnection (`${this.label}: connecting  ${this.lastElementChild.label} ${this.lastElementChild._out} to series output`);
this.lastElementChild._out.connect (this._out);
} // if

this.debugElementCreation (`created ${this.label}`);
} // connectAll


} // class AudioSeries

window.customElements.define(AudioSeries.is, AudioSeries);
</script>
</dom-module>
