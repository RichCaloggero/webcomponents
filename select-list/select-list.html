<template id="select-list-template">
<style>
.screen-reader-only {
position: absolute;
overflow: none;
left: -9999; top: -9999;
}

.select-list {
position: relative;
box-sizing: border-box;
display: inline-block;
/*width: 20em;*/
}

.listbox {
padding: 0;
margin: 0;
}

::content .option {
padding: .5em 1em;
min-height: 1em;
list-style: none;
cursor: pointer;
}

::content .option[hidden] {
display: none;
}

::content .option:focus {
outline: dotted 1px #333;
background: #e9e9e9;
}

::content .option:hover {
background: #e9e9e9;
}
</style>

<div class="select-list" role="group" aria-labelledby="label">
<span id="label"></span>

<ul class="listbox" role="listbox">
<slot></slot>
</ul>

<div class="status screen-reader-only" aria-live="polite"></div>
</div>
</template>

<script src="../bower_components/keyboard-navigation/keyboardNavigation.js"></script>

<script>
"use strict";
var template = document.querySelector("#select-list-template");

(function() {

customElements.define ("select-list", class extends HTMLElement {
constructor () {
super ();
//debug ("select-list element created");
} // constructor

connectedCallback () {
this.init();
this.render();
} // connectedCallback

init () {
this.initOptions();

this._root = this.createRootElement();
this._control = this._root.querySelector('.selectList');
this._label = this._root.querySelector("#label");
this._list = this._root.querySelector(".listbox");
this._status = this._root.querySelector(".status");

this._label.textContent = this._options.label;
this._status.classList.toggle ("screen-reader-only", !this._options.showStatusMessages);

} // init

initOptions () {
this._options = {
multiselect: this.hasAttribute("multiselect"),
label: this.getAttribute("label") || "",
showStatusMessages: this.getAttribute("showStatusMessages")
}; // options
} // initOptions

createRootElement () {
var root = this.attachShadow({delegatesFocus: true, mode: "open"});
var content = template.content.cloneNode(true);

root.appendChild(content);

//debug ("- root created");
return root;
} // createRootElement

render () {
this.attachHandlers();

//debug ("render complete.");
} // render

attachHandlers () {
var self = this;

this.currentItem = keyboardNavigation(this._list, {
multiselect: this._options.multiselect,

actions: {
toggleSelection: function (node) {
if (!node || !this._options.multiselect) return;

node.setAttribute ("aria-selected",
(node.getAttribute("aria-selected") === "true")? "false" : "true"
); // setAttribute
} // toggleSelection
}, // actions

keymap: {
toggleSelection: [" "]
} // keymap
}); // keyboardNavigation

//debug ("currentItem: ", this.currentItem, " value = ", this.currentItem().outerHTML);
} // attachHandlers

value () {
return this.querySelectorAll("[aria-selected='true']")
.map (node => this.valueOf(node));
} // value

valueOf (node) {
if (! node) return "";
return (node.hasAttribute("value"))?
node.getAttribute("value") : node.textContent;
} // valueOf


displayItemCount (text) {
this.statusMessage (this.querySelectorAll("[role=option]").length + " " + (text || "items"));
} // displayItemCount

statusMessage (text) {
this._status.textContent = text;
} // statusMessage

}); // custom element

})();

alert	 ("selectList component loaded");
</script>

